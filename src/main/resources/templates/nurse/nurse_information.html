<html layout:decorate="~{nurse/nurse_layout}">
<div layout:fragment="content" class="container ">
    <form class="info_form" th:action="@{|/nurse/info/${nurseDTO.nurseMain.id}|}" method="post">

        <h2 class="border-bottom py-2" th:text="|${nurseDTO.nurseMain.firstName} ${nurseDTO.nurseMain.lastName}|"></h2>

        <!-- Main 정보 -->
        <div class="main card my-3">

            <div class="m-d-btn">
                <div class="m-d-btn_box">
                    <a th:href="@{|/nurse/modify/${nurseDTO.nurseMain.id}|}" class="m-btn">수정</a>
                    <a href="javascript:void(0);" id="showLicenseFormBtn" class="l-btn">자격증 추가</a>
                    <a href="javascript:void(0);" th:data-uri="@{|/nurse/delete/${nurseDTO.nurseMain.id}|}" class="d-btn">삭제</a>
                </div>
            </div>

            <!-- 사진 -->
            <div class="image" th:if="${nurseDTO.nurseInformation != null}">
                <img th:if="${nurseDTO.nurseInformation.picture != null}" th:src="${nurseDTO.nurseInformation.picture}" alt="nurse Image" />
                <span th:if="${nurseDTO.nurseInformation.picture == null}">사진 없음</span>
            </div>

            <div class="basic_info">
                <p class="info">성명 <span th:text="|${nurseDTO.nurseMain.firstName} ${nurseDTO.nurseMain.middleName} ${nurseDTO.nurseMain.lastName}|"></span></p>
                <p class="info">부서 <span th:text="${nurseDTO.nurseMain.dept}"></span></p>
                <p class="info">직급 <span th:text="${nurseDTO.nurseMain.rank}"></span></p>
            </div>

            <p class="info_1">성명 <span th:text="|${nurseDTO.nurseMain.firstName} ${nurseDTO.nurseMain.middleName} ${nurseDTO.nurseMain.lastName}|"></span></p>
            <p class="info_1">부서 <span th:text="${nurseDTO.nurseMain.dept}"></span></p>
            <p class="info_1">직급 <span th:text="${nurseDTO.nurseMain.rank}"></span></p>
            <p class="info">성별 <span th:text="${nurseDTO.nurseMain.gender}"></span></p>
            <p class="info">생년월일 <span th:text="${nurseDTO.nurseMain.dateOfBirth}"></span></p>
            <p class="info">입사일 <span th:text="${nurseDTO.nurseMain.hireDate}"></span></p>
            <p class="info">상태 <span th:text="${nurseDTO.nurseMain.sts}"></span></p>
            <p class="info">근무형태 <span th:text="${nurseDTO.nurseMain.wt}"></span></p>
            <p class="info">작성자 <span th:text="${nurseDTO.nurseMain.writer}"></span></p>
            <p class="info">작성시간 <span th:text="${nurseDTO.nurseMain.createDate}"></span></p>
            <p class="info">수정자 <span th:text="${nurseDTO.nurseMain.modifier}"></span></p>
            <p class="info">수정시간 <span th:text="${nurseDTO.nurseMain.modifyDate}"></span></p>
        </div>

        <!-- Information 정보 -->
        <div class="information card my-3" th:if="${nurseDTO.nurseInformation != null}">
            <p class="info">서브 이름 <span th:text="|${nurseDTO.nurseInformation.firstName} ${nurseDTO.nurseInformation.lastName} ${nurseDTO.nurseInformation.middleName}|"></span></p>
            <p class="info">전화번호 <span th:text="${nurseDTO.nurseInformation.tel}"></span></p>
            <p class="info">비상연락처 <span th:text="${nurseDTO.nurseInformation.emgcCntc}"></span></p>
            <p class="info">비상연락처주 성함 <span th:text="|${nurseDTO.nurseInformation.emgcFName} ${nurseDTO.nurseInformation.emgcLName} ${nurseDTO.nurseInformation.emgcMName}|"></span></p>
            <p class="info">비상연락처 관계 <span th:text="${nurseDTO.nurseInformation.emgcRel}"></span></p>
            <p class="info">비상연락처 비고 <span th:text="${nurseDTO.nurseInformation.emgcNote}"></span></p>
            <p class="info">이메일 <span th:text="${nurseDTO.nurseInformation.email}"></span></p>
            <p class="info">우편번호 <span th:text="${nurseDTO.nurseInformation.pcd}"></span></p>
            <p class="info">기본주소 <span th:text="${nurseDTO.nurseInformation.defAdd}"></span></p>
            <p class="info">상세주소 <span th:text="${nurseDTO.nurseInformation.detAdd}"></span></p>
            <p class="info">간호사 자격증 번호 <span th:text="${nurseDTO.nurseInformation.rnNo}"></span></p>
            <p class="info">최종학력 <span th:text="${nurseDTO.nurseInformation.edbc}"></span></p>
            <p class="info">졸업날짜 <span th:text="${nurseDTO.nurseInformation.gradDate}"></span></p>
            <p class="info">외국어 <span th:text="${nurseDTO.nurseInformation.fl}"></span></p>
            <p class="info">병역 <span th:text="${nurseDTO.nurseInformation.ms}"></span></p>
            <p class="info">국적 <span th:text="${nurseDTO.nurseInformation.natn}"></span></p>
            <p class="info">장애여부 <span th:text="${nurseDTO.nurseInformation.dss}"></span></p>
            <p class="info">경력 <span th:text="${nurseDTO.nurseInformation.carr}"></span></p>
            <p class="info">비고 <span th:text="${nurseDTO.nurseInformation.note}"></span></p>
        </div>
    </form>
</div>
<!-- License 정보 -->
<div class="license card my-3">
    <h3 class="border-bottom py-2">자격증 정보</h3>

    <!-- 기존 자격증 수정 -->
    <form th:action="@{|/nurse/license/updateAll/${nurseDTO.nurseMain.id}|}" method="post" th:object="${nurseDTO}">
        <table class="table table-bordered text-center">
            <thead class="table-light">
            <tr>
                <th>자격증명</th>
                <th>번호</th>
                <th>발급일</th>
                <th>만료일</th>
                <th>비고</th>
                <th>관리</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="license, iterStat : *{licenseList}">
                <input type="hidden" th:field="*{licenseList[__${iterStat.index}__].id}" />
                <td><input type="text" th:field="*{licenseList[__${iterStat.index}__].li}" class="form-control"/></td>
                <td><input type="text" th:field="*{licenseList[__${iterStat.index}__].licenseNo}" class="form-control"/></td>
                <td><input type="text" th:field="*{licenseList[__${iterStat.index}__].issueDate}" class="form-control"/></td>
                <td><input type="text" th:field="*{licenseList[__${iterStat.index}__].expiryDate}" class="form-control"/></td>
                <td><input type="text" th:field="*{licenseList[__${iterStat.index}__].note}" class="form-control"/></td>
                <td>
                    <a th:href="@{|/nurse/license/delete/${license.id}/${nurseDTO.nurseMain.id}|}"
                       class="btn btn-sm btn-danger"
                       onclick="return confirm('정말 삭제하시겠습니까?');">삭제</a>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(nurseDTO.licenseList)}">
                <td colspan="6">등록된 자격증이 없습니다.</td>
            </tr>
            </tbody>
        </table>
        <div class="mt-2 text-end">
            <button type="submit" class="btn btn-success">저장</button>
        </div>
    </form>

    <!-- 새 자격증 추가 -->
    <form th:action="@{|/nurse/license/${nurseDTO.nurseMain.id}|}" method="post" class="mt-3 row g-2" id="licenseForm" style="display:none;">
        <div class="col"><input type="text" name="li" class="form-control" placeholder="자격증명" required></div>
        <div class="col"><input type="text" name="licenseNo" class="form-control" placeholder="자격증 번호" required></div>
        <div class="col"><input type="text" name="issueDate" class="form-control" placeholder="발급일 (YYYYMMDD)"></div>
        <div class="col"><input type="text" name="expiryDate" class="form-control" placeholder="만료일 (YYYYMMDD)"></div>
        <div class="col"><input type="text" name="note" class="form-control" placeholder="비고"></div>
        <div class="col-auto"><button type="submit" class="btn btn-primary">추가</button></div>
    </form>
</div>