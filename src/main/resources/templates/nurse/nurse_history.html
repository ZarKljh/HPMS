<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" layout:decorate="~{nurse/nurse_layout}">

<div layout:fragment="content" class="container-fluid my-4">

    <!-- 헤더 섹션 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h3 class="mb-0">간호사 정보 수정 히스토리</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- 검색 섹션 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border">
                <div class="card-header bg-light">
                    <h6 class="mb-0 text-secondary">검색 및 필터</h6>
                </div>
                <div class="card-body">
                    <form th:action="@{/nurse/history/search}" method="get" class="row g-3">
                        <div class="col-md-8">
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0">
                                    <span class="text-muted">🔍</span>
                                </span>
                                <input type="text"
                                       name="name"
                                       th:value="${searchName}"
                                       class="form-control border-start-0"
                                       placeholder="간호사 이름으로 검색하세요...">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <button type="submit" class="btn btn-dark me-2">검색</button>
                            <a th:href="@{/nurse/history}" class="btn btn-outline-secondary">전체 조회</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 결과 통계 -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="alert alert-light border">
                <div class="d-flex align-items-center">
                    <span class="text-muted me-2">📊</span>
                    <span>
                        총 <strong class="text-dark" th:text="${#lists.size(historyList)}">0</strong>건의 수정 이력이 있습니다.
                        <span th:if="${searchName != null and !#strings.isEmpty(searchName)}" class="text-muted">
                            (검색어: "<span class="fw-bold text-dark" th:text="${searchName}"></span>")
                        </span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- 히스토리 테이블 -->
    <div class="row">
        <div class="col-12">
            <div class="card border">
                <div class="card-header bg-light">
                    <h6 class="mb-0 text-secondary">수정 히스토리 목록</h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="w-100">
                            <tr class="text-nowrap">
                                <th class="text-center" style="width: 60px;">No</th>
                                <th class="text-center" style="width: 140px;">수정일시</th>
                                <th class="text-center" style="width: 180px;">간호사명</th>
                                <th class="text-center" style="width: 100px;">부서</th>
                                <th class="text-center" style="width: 100px;">직급</th>
                                <th class="text-center" style="width: 120px;">수정자</th>
                                <th class="text-center" style="width: 140px;">연락처</th>
                                <th class="text-center" style="width: 100px;">상세보기</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:if="${#lists.isEmpty(historyList)}">
                                <td colspan="8" class="text-center text-muted py-5">
                                    <div class="mb-3" style="font-size: 2.5rem;">📋</div>
                                    <div class="mb-2">수정 이력이 없습니다.</div>
                                    <small>등록된 히스토리가 없습니다.</small>
                                </td>
                            </tr>
                            <tr th:each="history, stat : ${historyList}" class="align-middle">
                                <td class="text-center" style="width: 60px;">
                                    <span class="badge bg-secondary" th:text="${stat.count}">1</span>
                                </td>
                                <td style="width: 140px;">
                                    <div class="d-flex text-center flex-column">
                                        <span class="fw-bold text-dark" th:text="${#temporals.format(history.createDate, 'yyyy-MM-dd')}">2024-01-01</span>
                                        <small class="text-muted" th:text="${#temporals.format(history.createDate, 'HH:mm')}">10:00</small>
                                    </div>
                                </td>
                                <td style="width: 180px;">
                                    <div class="d-flex text-center flex-column">
                                        <span class="fw-bold text-dark" th:text="${history.firstName + ' ' + history.lastName}">홍길동</span>
                                        <small th:if="${history.middleName != null and !#strings.isEmpty(history.middleName)}"
                                               class="text-muted"
                                               th:text="|중간명: ${history.middleName}|"></small>
                                    </div>
                                </td>
                                <td class="text-center" style="width: 100px;">
                                    <span th:if="${history.dept != null and !#strings.isEmpty(history.dept)}"
                                          class="badge bg-light text-dark border"
                                          th:text="${history.dept}">부서</span>
                                    <span th:unless="${history.dept != null and !#strings.isEmpty(history.dept)}"
                                          class="text-muted">-</span>
                                </td>
                                <td class="text-center" style="width: 100px;">
                                    <span th:if="${history.rank != null and !#strings.isEmpty(history.rank)}"
                                          class="badge bg-secondary"
                                          th:text="${history.rank}">직급</span>
                                    <span th:unless="${history.rank != null and !#strings.isEmpty(history.rank)}"
                                          class="text-muted">-</span>
                                </td>
                                <td class="text-center" style="width: 120px;">
                                    <div class="d-flex flex-column">
                                        <span class="small fw-bold" th:text="${history.modifier != null ? history.modifier : history.writer}">작성자</span>
                                        <span th:if="${history.modifier != null}" class="badge bg-warning text-dark small">수정됨</span>
                                        <span th:unless="${history.modifier != null}" class="badge bg-light text-dark small">생성</span>
                                    </div>
                                </td>
                                <td class="text-center" style="width: 140px;">
                                    <div class="d-flex flex-column">
                                        <span th:if="${history.tel != null and !#strings.isEmpty(history.tel)}"
                                              class="small text-dark"
                                              th:text="${history.tel}">010-1234-5678</span>
                                        <span th:unless="${history.tel != null and !#strings.isEmpty(history.tel)}"
                                              class="small text-muted">연락처 없음</span>
                                        <span th:if="${history.email != null and !#strings.isEmpty(history.email)}"
                                              class="small text-muted"
                                              th:text="${history.email}">email@example.com</span>
                                    </div>
                                </td>
                                <td class="text-center" style="width: 100px;">
                                    <a th:href="@{|/nurse/history/detail/${history.id}|}"
                                       class="btn btn-outline-dark btn-sm">
                                        상세보기
                                    </a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div th:if="${!#lists.isEmpty(historyList)}" class="card-footer bg-light border-top">
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            최신 순으로 정렬되었습니다.
                        </small>
                        <small class="text-muted">
                            총 <span th:text="${#lists.size(historyList)}">0</span>건의 결과
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<style>
    /* 테이블 호버 효과 */
    .table-hover tbody tr:hover {
        background-color: rgba(0,0,0,0.02);
    }

    /* 카드 호버 효과 */
    .card {
        transition: box-shadow 0.2s ease;
    }

    .card:hover {
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    /* 검색 입력 필드 */
    .input-group-text {
        border-color: #ced4da;
    }

    .form-control:focus {
        border-color: #495057;
        box-shadow: 0 0 0 0.2rem rgba(73, 80, 87, 0.25);
    }

    /* 배지 스타일 */
    .badge {
        font-size: 0.75rem;
        font-weight: 500;
    }

    /* 무채색 테마 */
    .bg-light {
        background-color: #f8f9fa !important;
    }

    .bg-secondary {
        background-color: #6c757d !important;
    }

    .bg-dark {
        background-color: #343a40 !important;
    }

    .text-secondary {
        color: #6c757d !important;
    }

    .border {
        border-color: #dee2e6 !important;
    }

    /* 알림 박스 */
    .alert-light {
        background-color: #fefefe;
        border-color: #dee2e6;
        color: #495057;
    }

    /* 모바일 반응형 최적화 */
    @media (max-width: 768px) {
        .container-fluid {
            padding: 0.5rem;
        }

        /* 헤더 최적화 */
        .card-header h3 {
            font-size: 1.2rem;
            text-align: center;
        }

        /* 검색 섹션 모바일 최적화 */
        .row.g-3 {
            margin: 0;
        }

        .row.g-3 > * {
            padding: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .col-md-8, .col-md-4 {
            flex: 0 0 100%;
            max-width: 100%;
        }

        .input-group {
            margin-bottom: 0.5rem;
        }

        .btn {
            font-size: 0.85rem;
            padding: 0.4rem 0.8rem;
            margin-bottom: 0.25rem;
        }

        /* 통계 섹션 최적화 */
        .alert {
            padding: 0.75rem;
            font-size: 0.9rem;
        }

        /* 테이블을 카드 형태로 변경 (모바일) */
        .table-responsive {
            border: none;
        }

        .table {
            font-size: 0.8rem;
        }

        .table th, .table td {
            padding: 0.4rem 0.2rem;
            vertical-align: middle;
        }

        /* 테이블 헤더 숨기기 및 카드 스타일 적용 */
        .table thead {
            display: none;
        }

        .table tbody tr {
            display: block;
            border: 1px solid #dee2e6;
            margin-bottom: 0.75rem;
            border-radius: 0.375rem;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .table tbody td {
            display: block;
            text-align: left !important;
            border: none;
            padding: 0.5rem 0.75rem;
            position: relative;
            padding-left: 35% !important;
        }

        .table tbody td:before {
            content: attr(data-label);
            position: absolute;
            left: 0.75rem;
            width: 30%;
            text-align: left;
            font-weight: 600;
            color: #6c757d;
            font-size: 0.75rem;
        }

        .table tbody td:first-child:before {
            content: "No";
        }

        .table tbody td:nth-child(2):before {
            content: "수정일시";
        }

        .table tbody td:nth-child(3):before {
            content: "간호사명";
        }

        .table tbody td:nth-child(4):before {
            content: "부서";
        }

        .table tbody td:nth-child(5):before {
            content: "직급";
        }

        .table tbody td:nth-child(6):before {
            content: "수정자";
        }

        .table tbody td:nth-child(7):before {
            content: "연락처";
        }

        .table tbody td:nth-child(8):before {
            content: "상세보기";
        }

        /* 배지 크기 조정 */
        .badge {
            font-size: 0.65rem;
            padding: 0.2rem 0.4rem;
        }

        /* 버튼 크기 조정 */
        .btn-sm {
            padding: 0.3rem 0.6rem;
            font-size: 0.75rem;
        }

        /* 카드 푸터 최적화 */
        .card-footer {
            padding: 0.5rem 0.75rem;
        }

        .card-footer .d-flex {
            flex-direction: column;
            gap: 0.25rem;
        }

        /* 하단 안내 섹션 최적화 */
        .row.text-center .col-md-4 {
            flex: 0 0 100%;
            max-width: 100%;
            margin-bottom: 1rem;
        }

        .row.text-center .col-md-4:last-child {
            margin-bottom: 0;
        }
    }

    /* 태블릿 최적화 */
    @media (max-width: 992px) and (min-width: 769px) {
        .container-fluid {
            padding: 0.75rem;
        }

        .table th, .table td {
            padding: 0.6rem 0.4rem;
            font-size: 0.9rem;
        }

        .btn {
            font-size: 0.9rem;
        }

        /* 테이블 정상 표시 (태블릿에서는) */
        .table thead {
            display: table-header-group;
        }

        .table tbody tr {
            display: table-row;
            border: none;
            margin: 0;
            border-radius: 0;
            background: transparent;
            box-shadow: none;
        }

        .table tbody td {
            display: table-cell;
            padding-left: 0.4rem !important;
        }

        .table tbody td:before {
            display: none;
        }
    }

    /* 아주 작은 화면 (iPhone SE 등) */
    @media (max-width: 576px) {
        .my-4 {
            margin: 0.5rem 0 !important;
        }

        .mb-4, .mb-3 {
            margin-bottom: 0.75rem !important;
        }

        .card-header h3 {
            font-size: 1rem;
            padding: 0.5rem;
        }

        .card-body {
            padding: 0.75rem;
        }

        .table tbody td {
            padding: 0.4rem 0.5rem;
            padding-left: 32% !important;
            font-size: 0.75rem;
        }

        .table tbody td:before {
            left: 0.5rem;
            width: 28%;
            font-size: 0.7rem;
        }

        .alert {
            padding: 0.5rem;
            font-size: 0.85rem;
        }

        .btn {
            font-size: 0.8rem;
            padding: 0.35rem 0.7rem;
        }
    }

    /* 큰 화면 최적화 */
    @media (min-width: 1200px) {
        .container-fluid {
            max-width: 1400px;
            margin: 0 auto;
        }

        .table th, .table td {
            padding: 0.75rem 0.5rem;
        }
    }

    /* 테이블 반응형 보조 - 작은 화면에서 테이블 복원 */
    @media (min-width: 769px) {
        .table thead {
            display: table-header-group !important;
        }

        .table tbody tr {
            display: table-row !important;
            border: none !important;
            margin: 0 !important;
            border-radius: 0 !important;
            background: transparent !important;
            box-shadow: none !important;
        }

        .table tbody td {
            display: table-cell !important;
            padding-left: 0.5rem !important;
        }

        .table tbody td:before {
            display: none !important;
        }
    }
</style>

</html>