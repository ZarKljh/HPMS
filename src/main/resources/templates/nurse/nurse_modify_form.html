<html layout:decorate="~{nurse/nurse_layout}">
<div layout:fragment="content" class="container my-3">
  <div th:if="${errorMessage != null}" class="alert alert-danger">
    <p th:text="${errorMessage}"></p>
  </div>
  <form th:action="@{/nurse/modify/{id}(id=${nurseDTO.nurseMain.id})}"
        th:object="${nurseDTO}" method="post" enctype="multipart/form-data">

    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

    <h3 class="border-bottom mt-2">간호사 정보 수정</h3>

    <div class="nursemain card my-3 p-3">
      <!-- NurseMain 정보 -->
      <h4 class="border-bottom mt-2">기본 정보</h4>

      <div class="input-list">
        <label>이름:</label>
        <input type="text" th:field="*{nurseMain.firstName}" maxlength="50" required/>
      </div>

      <div class="input-list">
        <label>성:</label>
        <input type="text" th:field="*{nurseMain.lastName}" maxlength="50" required/>
      </div>

      <div class="input-list">
        <label>중간 이름:</label>
        <input type="text" th:field="*{nurseMain.middleName}" maxlength="50"/>
      </div>

      <div class="input-list">
        <label>부서:</label>
        <div class="select-wrapper" data-role="selectbox">
          <button type="button" class="toggle_btn">
            부서 선택
            <span class="material-symbols-rounded">arrow_drop_down</span>
          </button>
          <ul class="hide selectbox_option">
            <li><button type="button" class="option-btn" data-value="마취통증의학과">마취통증의학과</button></li>
            <li><button type="button" class="option-btn" data-value="치과">치과</button></li>
            <li><button type="button" class="option-btn" data-value="피부과">피부과</button></li>
            <li><button type="button" class="option-btn" data-value="응급의학과">응급의학과</button></li>
            <li><button type="button" class="option-btn" data-value="이비인후과">이비인후과</button></li>
            <li><button type="button" class="option-btn" data-value="안과">안과</button></li>
            <li><button type="button" class="option-btn" data-value="가정의학과">가정의학과</button></li>
            <li><button type="button" class="option-btn" data-value="외과">외과</button></li>
            <li><button type="button" class="option-btn" data-value="내과">내과</button></li>
            <li><button type="button" class="option-btn" data-value="진단검사의학과">진단검사의학과</button></li>
            <li><button type="button" class="option-btn" data-value="핵의학과">핵의학과</button></li>
            <li><button type="button" class="option-btn" data-value="신경과">신경과</button></li>
            <li><button type="button" class="option-btn" data-value="신경외과">신경외과</button></li>
            <li><button type="button" class="option-btn" data-value="산부인과">산부인과</button></li>
            <li><button type="button" class="option-btn" data-value="직업환경의학과">직업환경의학과</button></li>
            <li><button type="button" class="option-btn" data-value="정형외과">정형외과</button></li>
            <li><button type="button" class="option-btn" data-value="병리과">병리과</button></li><li><button type="button" class="option-btn" data-value="nurse">간호사</button></li>
            <li><button type="button" class="option-btn" data-value="소아청소년과">소아청소년과</button></li>
            <li><button type="button" class="option-btn" data-value="예방의학과">예방의학과</button></li>
            <li><button type="button" class="option-btn" data-value="성형외과">성형외과</button></li>
            <li><button type="button" class="option-btn" data-value="정신건강의학과">정신건강의학과</button></li>
            <li><button type="button" class="option-btn" data-value="방사선과">방사선과</button></li><li><button type="button" class="option-btn" data-value="nurse">간호사</button></li>
            <li><button type="button" class="option-btn" data-value="영상의학과">영상의학과</button></li>
            <li><button type="button" class="option-btn" data-value="재활의학과">재활의학과</button></li>
            <li><button type="button" class="option-btn" data-value="방사선종양학과">방사선종양학과</button></li>
            <li><button type="button" class="option-btn" data-value="결핵과">결핵과</button></li>
            <li><button type="button" class="option-btn" data-value="흉부외과">흉부외과</button></li>
            <li><button type="button" class="option-btn" data-value="비뇨기과">비뇨기과</button></li>
            <li><button type="button" class="option-btn" data-value="비뇨의학과">비뇨의학과</button></li>
          </ul>
          <!-- 실제 form 전송용 -->
          <input type="hidden" th:field="*{nurseMain.dept}" required/>
        </div>
      </div>

      <div class="input-list">
        <label>직급:</label>
        <div class="select-wrapper" data-role="selectbox">
          <button type="button" class="toggle_btn">
            직급 선택
            <span class="material-symbols-rounded">arrow_drop_down</span>
          </button>
          <ul class="hide selectbox_option">
            <li><button type="button" class="option-btn" data-value="간호부장">간호부장</button></li>
            <li><button type="button" class="option-btn" data-value="수간호사">수간호사</button></li>
            <li><button type="button" class="option-btn" data-value="수간호장">수간호장</button></li>
            <li><button type="button" class="option-btn" data-value="책임">책임간호사</button></li>
            <li><button type="button" class="option-btn" data-value="주임">주임간호사</button></li>
            <li><button type="button" class="option-btn" data-value="일반">일반간호사</button></li>
            <li><button type="button" class="option-btn" data-value="신규">신규간호사</button></li>
            <li><button type="button" class="option-btn" data-value="실습생">간호학생(실습생)</button></li>
          </ul>
          <!-- 실제 form 전송용 -->
          <input type="hidden" th:field="*{nurseMain.rank}" required/>
        </div>
      </div>

      <div class="input-list">
        <label>성별:</label>
        <div class="form-check">
          <input type="radio" th:field="*{nurseMain.gender}" value="M" style="width: auto;"/> 남
        </div>
        <div class="form-check">
          <input type="radio" th:field="*{nurseMain.gender}" value="F" style="width: auto;"/> 여
        </div>
      </div>

      <div class="input-list">
        <label>생년월일:</label>
        <input type="text" th:field="*{nurseMain.dateOfBirth}" maxlength="8" required class="numeric-only"/>
      </div>

      <div class="input-list">
        <label>입사일:</label>
        <input type="text" th:field="*{nurseMain.hireDate}" maxlength="8" required class="numeric-only"/>
      </div>

      <div class="input-list">
        <label>상태:</label>
        <input type="text" th:field="*{nurseMain.sts}" maxlength="3" required/>
      </div>

      <div class="input-list">
        <label>근무형태:</label>
        <input type="text" th:field="*{nurseMain.wt}" maxlength="4" required/>
      </div>

      <div class="input-list">
        <label>수정자:</label>
        <input type="text" th:field="*{nurseMain.modifier}" maxlength="250" required/>
      </div>

    <!-- NurseInformation 정보 -->
      <h3 class="border-bottom mt-2">상세 정보</h3>
      <div class="input-list">
        <label>예명:</label>
        <input type="text" th:field="*{nurseInformation.firstName}" maxlength="50"/>
        <input type="text" th:field="*{nurseInformation.lastName}" maxlength="50"/>
        <input class="middle_name" type="text" th:field="*{nurseInformation.middleName}" maxlength="50"/>
      </div>

      <div class="input-list">
        <label>전화번호:</label>
        <input type="text" th:field="*{nurseInformation.tel}" maxlength="25" placeholder="010-1234-5678" required/>
      </div>

      <div class="input-list">
        <label>비상연락처:</label>
        <input type="text" th:field="*{nurseInformation.emgcCntc}" placeholder="010-1234-5678" maxlength="25" required/>
      </div>

      <div class="input-list">
        <label>성명:</label>
        <input type="text" th:field="*{nurseInformation.emgcFName}" maxlength="50" required/>
        <input type="text" th:field="*{nurseInformation.emgcLName}" maxlength="50" required/>
        <input class="middle_name" type="text" th:field="*{nurseInformation.emgcMName}" maxlength="50"/>
      </div>

      <div class="input-list">
        <label>관계:</label>
        <input type="text" th:field="*{nurseInformation.emgcRel}" maxlength="10" required/>
      </div>

      <div class="input-list">
        <label>비고:</label>
        <input type="text" th:field="*{nurseInformation.emgcNote}" maxlength="250"/>
      </div>

      <div class="input-list">
        <label>이메일:</label>
        <input type="text" th:field="*{nurseInformation.email}" maxlength="250" required/>
      </div>

      <div class="input-list">
        <label>우편번호:</label>
        <input type="text" th:field="*{nurseInformation.pcd}" id="addr" maxlength="10" required/>
      </div>

      <div class="input-list">
        <label>주소:</label>
        <div style="display:flex; gap:8px; align-items:center;">
          <input type="text" th:field="*{nurseInformation.defAdd}" id="addr1" maxlength="250" required/>
          <button type="button" class="button-link" onclick="openRoadPopup()">도로명 검색</button>
        </div>
      </div>

      <div class="input-list">
        <label>상세주소:</label>
        <input type="text" th:field="*{nurseInformation.detAdd}" id="addr2" maxlength="250"/>
      </div>

      <div class="input-list">
        <label>자격증 번호:</label>
        <input type="text" th:field="*{nurseInformation.rnNo}" maxlength="6" required/>
      </div>

      <div class="input-list">
        <label>최종학력:</label>
        <input type="text" th:field="*{nurseInformation.edbc}" maxlength="50" required/>
      </div>

      <div class="input-list">
        <label>졸업날짜:</label>
        <input type="text" th:field="*{nurseInformation.gradDate}" maxlength="8" required class="numeric-only"/>
      </div>

      <div class="input-list">
        <label>외국어:</label>
        <input type="text" th:field="*{nurseInformation.fl}" maxlength="250"/>
      </div>

      <div class="input-list">
        <label>병역:</label>
        <div class="select-wrapper" data-role="selectbox">
          <button type="button" class="toggle_btn">
            병역 선택
            <span class="material-symbols-rounded">arrow_drop_down</span>
          </button>
          <ul class="hide selectbox_option">
            <li><button type="button" class="option-btn" data-value="군필">군필</button></li>
            <li><button type="button" class="option-btn" data-value="미필">미필</button></li>
            <li><button type="button" class="option-btn" data-value="면제">면제</button></li>
          </ul>
          <!-- 실제 form 전송용 -->
          <input type="hidden" th:field="*{nurseInformation.ms}" required/>
        </div>
      </div>

      <div class="input-list">
        <label>국적</label>
        <div>
          <span id="nationalityDisplay" th:text="*{nurseInformation.natn} ?: '-'">-</span>
          <input type="hidden" th:field="*{nurseInformation.natn}" id="nationalityInput" required/>
          <button type="button" class="button-link" style="margin-left:8px;" onclick="openCountryPopup()">국적 검색</button>
        </div>
      </div>

      <div class="input-list">
        <label>장애 여부:</label>
        <div class="select-wrapper" data-role="selectbox">
          <button type="button" class="toggle_btn">
            장애여부 선택
            <span class="material-symbols-rounded">arrow_drop_down</span>
          </button>
          <ul class="hide selectbox_option">
            <li><button type="button" class="option-btn" data-value="Y">유</button></li>
            <li><button type="button" class="option-btn" data-value="N">무</button></li>
          </ul>
          <!-- 실제 form 전송용 -->
          <input type="hidden" th:field="*{nurseInformation.dss}" required/>
        </div>
      </div>

      <div class="input-list">
        <label>경력:</label>
        <input type="text" th:field="*{nurseInformation.carr}" maxlength="5" required class="numeric-only"/>
      </div>

      <div class="input-list">
        <label>사진:</label>
        <!-- 파일 업로드 -->
        <input type="file" id="pictureFile" name="pictureFile" accept="image/*" />
        <!-- 미리보기 -->
        <div class="mt-2">
          <img id="picturePreview"
               th:src="${nurseDTO?.nurseInformation?.picture ?: '/images/default.png'}"
               alt="사진 미리보기"
               style="width: 150px; height: 150px; object-fit: cover; display:block;" />
        </div>
          <!-- 실제 DB 저장용 hidden 필드 -->
        <input type="hidden" th:field="*{nurseInformation.picture}" id="pictureUrl"/>
      </div>

      <div class="input-list">
        <label>비고:</label>
        <textarea th:field="*{nurseInformation.note}" class="form-control" maxlength="250"></textarea>
      </div>
    </div>

    <div class="c_c_btn_box d-flex justify-content-end">
      <button type="button" class="button-link me-2">저장</button>
      <a th:href="@{|/nurse/info/${nurseDTO.nurseMain.id}|}" class="button-link">취소</a>
    </div>
  </form>
</div>
</html>