<html layout:decorate="~{nurse/nurse_layout}">
<div layout:fragment="content" class="container my-3">
  <div th:if="${errorMessage != null}" class="alert alert-danger">
    <p th:text="${errorMessage}"></p>
  </div>
  <form th:action="@{/nurse/modify/{id}(id=${nurseDTO.nurseMain.id})}"
        th:object="${nurseDTO}" method="post">

    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

    <h3 class="border-bottom mt-2">간호사 정보 수정</h3>

    <!-- NurseMain 정보 -->
    <div class="nursemain card my-3 p-3">
      <h4 class="border-bottom mt-2">기본 정보</h4>

      <div class="input-list">
        <label>이름:</label>
        <input type="text" th:field="*{nurseMain.firstName}" maxlength="50" required/>
      </div>

      <div class="input-list">
        <label>성:</label>
        <input type="text" th:field="*{nurseMain.lastName}" maxlength="50" required/>
      </div>

      <div class="input-list">
        <label>중간 이름:</label>
        <input type="text" th:field="*{nurseMain.middleName}" maxlength="50"/>
      </div>

      <div class="input-list">
        <label>부서:</label>
        <select th:field="*{nurseMain.dept}" required>
          <option value="">선택</option>
          <option value="AN">마취통증의학과</option>
          <option value="DEN">치과</option>
          <option value="DER">피부과</option>
          <option value="EM">응급의학과</option>
          <option value="ENT">이비인후과</option>
          <option value="OPH">안과</option>
          <option value="FM">가정의학과</option>
          <option value="GS">외과</option>
          <option value="IM">내과</option>
          <option value="LM">진단검사의학과</option>
          <option value="NM">핵의학과</option>
          <option value="NR">신경과</option>
          <option value="NS">신경외과</option>
          <option value="OBGY">산부인과</option>
          <option value="OEM">직업환경의학과</option>
          <option value="OS">정형외과</option>
          <option value="PA">병리과</option>
          <option value="PED">소아청소년과</option>
          <option value="PM">예방의학과</option>
          <option value="PS">성형외과</option>
          <option value="PSI">정신건강의학과</option>
          <option value="RD">방사선과</option>
          <option value="RAD">영상의학과</option>
          <option value="RM">재활의학과</option>
          <option value="RO">방사선종양학과</option>
          <option value="TB">결핵과</option>
          <option value="TS">흉부외과</option>
          <option value="UR">비뇨기과</option>
        </select>
      </div>

      <div class="input-list">
        <label>직급:</label>
        <input type="text" th:field="*{nurseMain.rank}" maxlength="4" required/>
      </div>

      <div class="input-list">
        <label>성별:</label>
        <div class="form-check">
          <input type="radio" th:field="*{nurseMain.gender}" value="M" /> 남
        </div>
        <div class="form-check">
          <input type="radio" th:field="*{nurseMain.gender}" value="F" /> 여
        </div>
      </div>

      <div class="input-list">
        <label>생년월일:</label>
        <input type="number" th:field="*{nurseMain.dateOfBirth}" maxlength="8" required/>
      </div>

      <div class="input-list">
        <label>입사일:</label>
        <input type="number" th:field="*{nurseMain.hireDate}" maxlength="8" required/>
      </div>

      <div class="input-list">
        <label>상태:</label>
        <input type="text" th:field="*{nurseMain.sts}" maxlength="3" required/>
      </div>

      <div class="input-list">
        <label>근무형태:</label>
        <input type="text" th:field="*{nurseMain.wt}" maxlength="4" required/>
      </div>

      <div class="input-list">
        <label>수정자:</label>
        <input type="text" th:field="*{nurseMain.modifier}" maxlength="250" required/>
      </div>

    <!-- NurseInformation 정보 -->
      <h3 class="border-bottom mt-2">상세 정보</h3>
      <div class="input-list">
      <label>예명:</label>
        <input type="text" th:field="*{nurseInformation.firstName}" maxlength="50"/>
        <input type="text" th:field="*{nurseInformation.lastName}" maxlength="50"/>
        <input type="text" th:field="*{nurseInformation.middleName}" maxlength="50"/>
      </div>

      <div class="input-list">
        <label>전화번호:</label>
        <input type="text" th:field="*{nurseInformation.tel}" maxlength="25" required/>
      </div>

      <div class="input-list">
        <label>비상연락처:</label>
        <input type="text" th:field="*{nurseInformation.emgcCntc}" maxlength="25" required/>
      </div>

      <div class="input-list">
        <label>성명:</label>
        <input type="text" th:field="*{nurseInformation.emgcFName}" maxlength="50" required/>
        <input type="text" th:field="*{nurseInformation.emgcLName}" maxlength="50" required/>
        <input type="text" th:field="*{nurseInformation.emgcMName}" maxlength="50"/>
      </div>

      <div class="input-list">
        <label>관계:</label>
        <input type="text" th:field="*{nurseInformation.emgcRel}" maxlength="10" required/>
      </div>

      <div class="input-list">
        <label>비고:</label>
        <input type="text" th:field="*{nurseInformation.emgcNote}" maxlength="250"/>
      </div>

      <div class="input-list">
        <label>이메일:</label>
        <input type="text" th:field="*{nurseInformation.email}" maxlength="250" required/>
      </div>

      <div class="input-list">
        <label>우편번호:</label>
        <input type="text" th:field="*{nurseInformation.pcd}" id="addr" maxlength="10" required/>
      </div>

      <div class="input-list">
        <label>주소:</label>
        <div style="display:flex; gap:8px; align-items:center;">
          <input type="text" th:field="*{nurseInformation.defAdd}" id="addr1" maxlength="250" required/>
          <button type="button" class="button-link" onclick="openRoadPopup()">도로명 검색</button>
        </div>
      </div>

      <div class="input-list">
        <label>상세주소:</label>
        <input type="text" th:field="*{nurseInformation.detAdd}" id="addr2" maxlength="250"/>
      </div>

      <div class="input-list">
        <label>자격증 번호:</label>
        <input type="text" th:field="*{nurseInformation.rnNo}" maxlength="6" required/>
      </div>

      <div class="input-list">
        <label>최종학력:</label>
        <input type="text" th:field="*{nurseInformation.edbc}" maxlength="50" required/>
      </div>

      <div class="input-list">
        <label>졸업날짜:</label>
        <input type="text" th:field="*{nurseInformation.gradDate}" maxlength="8" required/>
      </div>

      <div class="input-list">
        <label>외국어:</label>
        <input type="text" th:field="*{nurseInformation.fl}" maxlength="250"/>
      </div>

      <div class="input-list">
        <label>병역:</label>
        <select th:field="*{nurseInformation.ms}" required>
          <option value="">선택</option>
          <option value="군필">군필</option>
          <option value="미필">미필</option>
          <option value="면제">면제</option>
        </select>
      </div>

      <div class="input-list">
        <label>국적</label>
        <div>
          <span id="nationalityDisplay" th:text="*{nurseInformation.natn} ?: '-'">-</span>
          <input type="hidden" th:field="*{nurseInformation.natn}" id="nationalityInput" required/>
          <button type="button" class="button-link" style="margin-left:8px;" onclick="openCountryPopup()">국적 검색</button>
        </div>
      </div>

      <div class="input-list">
        <label>장애 여부:</label>
        <select th:field="*{nurseInformation.dss}" required>
          <option value="">선택</option>
          <option value="Y">유</option>
          <option value="N">무</option>
        </select>
      </div>

      <div class="input-list">
        <label>경력:</label>
        <input type="text" th:field="*{nurseInformation.carr}" maxlength="5" required/>
      </div>

      <div>
        <label>사진 URL</label>
        <input type="text" th:field="*{nurseInformation.picture}"
               placeholder="https://example.com/photo.jpg" maxlength="250" required/>
        <div class="mt-2">
          <span th:if="*{nurseInformation.picture == null}">사진 없음</span>
        </div>
      </div>

      <div class="input-list">
        <label>비고:</label>
        <textarea th:field="*{nurseInformation.note}" class="form-control" maxlength="250"></textarea>
      </div>
    </div>

    <div class="c_c_btn_box d-flex justify-content-end">
      <button type="submit" class="button-link me-2">저장</button>
      <a th:href="@{|/nurse/info/${nurseDTO.nurseMain.id}|}" class="button-link">취소</a>
    </div>
  </form>
  <div th:if="${errorMessage}" th:text="${errorMessage}" style="color:red;"></div>
</div>
