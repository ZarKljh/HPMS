<!doctype html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{doctor/doctor_layout}">

<th:block layout:fragment="content">
    <div class="container my-3">

        <!-- 에러 메시지 -->
        <div th:if="${errorMessage != null}" class="alert alert-danger">
            <p th:text="${errorMessage}"></p>
        </div>

        <!-- 하나의 폼 안에서 mForm / dForm 을 구역별로 분리 -->
        <form th:action="@{/doctor/edit/{id}(id=${doctorId})}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <div class="card my-3 p-3">
                <h3 class="border-bottom mt-2">의사 정보 수정</h3>

                <!-- =========================
                     mForm 구역 (DoctorM)
                     ========================= -->
                <th:block th:object="${mForm}">
                    <h4 class="border-bottom mt-2">기본정보</h4>

                    <div class="input-list">
                        <label>성:</label>
                        <input type="text" th:field="*{lastName}" maxlength="50" required/>
                    </div>
                    <div class="input-list">
                        <label>이름:</label>
                        <input type="text" th:field="*{firstName}" maxlength="50" required/>
                    </div>
                    <div class="input-list">
                        <label>중간 이름:</label>
                        <input type="text" th:field="*{middleName}" maxlength="50"/>
                    </div>
                    <div class="input-list">
                        <label>성별:</label>
                        <div class="form-check" style="display:flex; gap:16px; align-items:center;">
                            <label class="mb-0"><input type="radio" th:field="*{gender}" value="M" required/> 남</label>
                            <label class="mb-0"><input type="radio" th:field="*{gender}" value="F"/> 여</label>
                        </div>
                    </div>
                    <div class="input-list">
                        <label>생년월일:</label>
                        <input type="date" th:field="*{dateOfBirth}" required/>
                    </div>
                    <div class="input-list">
                        <label>전화번호:</label>
                        <input type="text" th:field="*{telephone}" maxlength="20" required/>
                    </div>

                    <h4 class="border-bottom mt-4">조직정보</h4>
                    <div class="input-list">
                        <label>부서:</label>
                        <input type="text" th:field="*{department}" maxlength="4" required/>
                    </div>
                    <div class="input-list">
                        <label>진료과:</label>
                        <input type="text" th:field="*{medicalDepartment}" maxlength="50"/>
                    </div>
                    <div class="input-list">
                        <label>직급:</label>
                        <input type="text" id="rank" th:field="*{rank}" maxlength="4"/>
                    </div>
                    <div class="input-list">
                        <label>직책:</label>
                        <input type="text" id="position" th:field="*{position}" maxlength="4"/>
                    </div>
                    <div class="input-list" style="gap:8px; align-items:center;">
                        <a href="javascript:void(0)" class="button-link" onclick="openJobPopup()">직급/직책 선택</a>
                    </div>

                    <h4 class="border-bottom mt-4">고용상태</h4>
                    <div class="input-list">
                        <label>입사일:</label>
                        <input type="date" th:field="*{hireDate}" required/>
                    </div>
                    <div class="input-list">
                        <label>상태:</label>
                        <input type="text" th:field="*{status}" maxlength="3" required/>
                    </div>
                    <div class="input-list">
                        <label>근무형태:</label>
                        <input type="text" th:field="*{workType}" maxlength="4" required/>
                    </div>
                </th:block>

                <!-- =========================
                     dForm 구역 (DoctorDTL)
                     ========================= -->
                <th:block th:object="${dForm}">
                    <h4 class="border-bottom mt-2">계정</h4>
                    <div class="input-list">
                        <label>User ID:</label>
                        <input type="text" th:field="*{userId}" maxlength="20"/>
                    </div>
                    <div class="input-list">
                        <label>Password:</label>
                        <input type="password" th:field="*{userPassword}" maxlength="100" placeholder="새 비밀번호 입력"/>
                    </div>

                    <input type="hidden" th:field="*{doctorId}"/>

                    <h4 class="border-bottom mt-4">상세정보</h4>
                    <div class="input-list">
                        <label>사진(파일명.확장자):</label>
                        <input type="text" th:field="*{image}" maxlength="250"/>
                    </div>
                    <div class="input-list">
                        <label>이메일:</label>
                        <input type="email" th:field="*{email}" maxlength="250"/>
                    </div>
                    <div class="input-list">
                        <label>사무실 전화:</label>
                        <input type="text" th:field="*{officeTelephone}" maxlength="20" required/>
                    </div>
                    <div class="input-list">
                        <label>우편번호:</label>
                        <input type="text" th:field="*{postcode}" maxlength="6"/>
                    </div>
                    <div class="input-list">
                        <label>도로명주소:</label>
                        <div style="display:flex; gap:8px; align-items:center;">
                            <input type="text" th:field="*{defaultAddress}" id="addr1" maxlength="250"/>
                            <a href="javascript:void(0)" class="button-link" onclick="openRoadPopup()">도로명 검색</a>
                        </div>
                    </div>
                    <div class="input-list">
                        <label>상세주소:</label>
                        <input type="text" th:field="*{detailedAddress}" maxlength="250"/>
                    </div>

                    <h4 class="border-bottom mt-4">비상연락</h4>
                    <div class="input-list">
                        <label>비상 연락처:</label>
                        <input type="text" th:field="*{emergencyContact}" maxlength="20"/>
                    </div>
                    <div class="input-list">
                        <label>비상 성:</label>
                        <input type="text" th:field="*{emergencyLastName}" maxlength="50"/>
                    </div>
                    <div class="input-list">
                        <label>비상 이름:</label>
                        <input type="text" th:field="*{emergencyFirstName}" maxlength="50"/>
                    </div>
                    <div class="input-list">
                        <label>비상 중간이름:</label>
                        <input type="text" th:field="*{emergencyMiddleName}" maxlength="50"/>
                    </div>
                    <div class="input-list">
                        <label>관계:</label>
                        <input type="text" th:field="*{emergencyRelation}" maxlength="10"/>
                    </div>
                    <div class="input-list">
                        <label>비고:</label>
                        <input type="text" th:field="*{emergencyNote}" maxlength="250"/>
                    </div>

                    <h4 class="border-bottom mt-4">자격정보</h4>
                    <div class="input-list">
                        <label>면허번호:</label>
                        <input type="text" th:field="*{registrationNumber}" maxlength="10"/>
                    </div>
                    <div class="input-list">
                        <label>학력:</label>
                        <input type="text" th:field="*{educationalBackground}" maxlength="100"/>
                    </div>
                    <div class="input-list">
                        <label>전공과:</label>
                        <input type="text" th:field="*{major}" maxlength="50"/>
                    </div>
                    <div class="input-list">
                        <label>외국어:</label>
                        <input type="text" th:field="*{foreignLanguage}" maxlength="250"/>
                    </div>
                    <div class="input-list">
                        <label>기타 자격증:</label>
                        <input type="text" th:field="*{license}" maxlength="250"/>
                    </div>

                    <h4 class="border-bottom mt-4">경력</h4>
                    <div class="input-list">
                        <label>근무경력:</label>
                        <input type="text" th:field="*{workDependsOnExperience}" maxlength="250"/>
                    </div>
                    <div class="input-list">
                        <label>수상경력:</label>
                        <input type="text" th:field="*{awards}" maxlength="250"/>
                    </div>
                    <div class="input-list">
                        <label>학회활동:</label>
                        <input type="text" th:field="*{societyActivity}" maxlength="250"/>
                    </div>
                    <div class="input-list">
                        <label>학회인증:</label>
                        <input type="text" th:field="*{certificateOfSociety}" maxlength="250"/>
                    </div>

                    <h4 class="border-bottom mt-4">기타 인적사항</h4>
                    <div class="input-list">
                        <label>병역:</label>
                        <input type="text" th:field="*{militaryService}" maxlength="10"/>
                    </div>
                    <div class="input-list">
                        <label>국적:</label>
                        <!-- 텍스트 입력으로 운영 -->
                        <input type="text" th:field="*{nationality}" id="nationalityInput" maxlength="100" placeholder="예) 대한민국 (KR)"/>
                    </div>
                    <div class="input-list">
                        <label>장애 여부:</label>
                        <div class="form-check" style="display:flex; gap:16px; align-items:center;">
                            <label class="mb-0"><input type="radio" th:field="*{disabilityStatus}" value="Y"/> 유</label>
                            <label class="mb-0"><input type="radio" th:field="*{disabilityStatus}" value="N"/> 무</label>
                        </div>
                    </div>

                    <h4 class="border-bottom mt-4">비고</h4>
                    <div class="input-list">
                        <label>비고:</label>
                        <input type="text" th:field="*{note}" maxlength="255"/>
                    </div>
                </th:block>

                <div class="d-flex justify-content-end mt-3">
                    <button type="submit" class="button-link me-2">저장</button>
                    <a th:href="@{/doctor/dtl/detail(id=${doctorId})}" class="button-link">취소</a>
                </div>
            </div>
        </form>

        <div th:if="${errorMessage}" th:text="${errorMessage}" style="color:red;"></div>
    </div>
</th:block>
</html>
