<!doctype html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{doctor/doctor_layout}">

<th:block layout:fragment="script">
  <script defer th:src="@{/js/doctor_edit.js}"></script>
</th:block>

<th:block layout:fragment="content">
  <div class="container detail-container page-narrow">
    <div class="mb-2">
      <h3 class="listbox mt-2">의사 수정</h3>
      <p class="detail-subtitle">현재 등록된 의사의 정보를 수정합니다.</p>
    </div>

    <!-- ✅ 폼이 카드 + 하단 버튼까지 모두 감쌈 -->
    <form th:action="@{/doctor/edit/{id}(id=${doctorId})}" method="post" th:object="${mForm}">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

      <!-- ✅ 카드 단 1개 -->
      <div class="detail-card card shadow-sm">
        <!-- 메인 정보 -->
        <h4 class="section-heading">메인 정보</h4>
        <div class="section-divider"></div>
        <fieldset>
          <div class="grid">
            <label>부서</label> <input type="text" th:field="*{department}" maxlength="4" required/>
            <label>진료과</label> <input type="text" th:field="*{medicalDepartment}" maxlength="50"/>

            <label>직책</label> <input type="text" id="rank" th:field="*{rank}" maxlength="4"/>
            <label>직급</label> <input type="text" id="position" th:field="*{position}" maxlength="4"/>
            <div class="job-actions">
              <button type="button" class="page-btn" onclick="openJobPopup()">직급/직책 선택</button>
            </div>

            <label>이름</label> <input type="text" th:field="*{firstName}" maxlength="50" required/>
            <label>성</label>   <input type="text" th:field="*{lastName}" maxlength="50" required/>
            <label>중간이름</label> <input type="text" th:field="*{middleName}" maxlength="50"/>

            <label>성별</label>
            <div style="display:flex;gap:12px;align-items:center;">
              <label><input type="radio" th:field="*{gender}" value="M" required> M</label>
              <label><input type="radio" th:field="*{gender}" value="F"> F</label>
            </div>

            <label>생년월일</label> <input type="date" th:field="*{dateOfBirth}" required/>
            <label>전화번호</label> <input type="text" th:field="*{telephone}" maxlength="20" required/>
            <label>입사일</label> <input type="date" th:field="*{hireDate}" required/>
            <label>상태</label> <input type="text" th:field="*{status}" maxlength="3" required/>
            <label>근무형태</label> <input type="text" th:field="*{workType}" maxlength="4" required/>
          </div>
        </fieldset>

        <!-- 상세 정보 -->
        <h4 class="section-heading mt-4">상세 정보</h4>
        <div class="section-divider"></div>
        <fieldset th:object="${dForm}">
          <input type="hidden" th:field="*{doctorId}"/>
          <div class="grid">
            <label>이미지 URL</label> <input type="text" th:field="*{image}" maxlength="250" required/>
            <label>User ID</label>   <input type="text" th:field="*{userId}" maxlength="20" required/>
            <label>Password (변경 시에만)</label>
            <input type="password" th:field="*{userPassword}" maxlength="100" placeholder="새 비밀번호 입력"/>

            <label>사무실 전화</label> <input type="text" th:field="*{officeTelephone}" maxlength="20" required/>
            <label>비상연락처</label>  <input type="text" th:field="*{emergencyContact}" maxlength="20"/>

            <label>비상-이름</label> <input type="text" th:field="*{emergencyFirstName}" maxlength="50"/>
            <label>비상-성</label>   <input type="text" th:field="*{emergencyLastName}" maxlength="50"/>
            <label>비상-중간이름</label> <input type="text" th:field="*{emergencyMiddleName}" maxlength="50"/>
            <label>비상-관계</label> <input type="text" th:field="*{emergencyRelation}" maxlength="10"/>
            <label>비상-비고</label> <input type="text" th:field="*{emergencyNote}" maxlength="250"/>

            <label>이메일</label>    <input type="email" th:field="*{email}" maxlength="250"/>
            <label>우편번호</label>  <input type="text" th:field="*{postcode}" maxlength="6"/>

            <label>도로명주소</label>
            <div style="display:flex;gap:8px;align-items:center;">
              <input type="text" th:field="*{defaultAddress}" id="addr1" maxlength="250"/>
              <button type="button" class="page-btn" onclick="openRoadPopup()">도로명 검색</button>
            </div>

            <label>상세주소</label>  <input type="text" th:field="*{detailedAddress}" maxlength="250"/>

            <label>면허번호</label>  <input type="text" th:field="*{registrationNumber}" maxlength="10" required/>
            <label>학력</label>      <input type="text" th:field="*{educationalBackground}" maxlength="100"/>
            <label>외국어</label>    <input type="text" th:field="*{foreignLanguage}" maxlength="250"/>
            <label>기타자격증</label> <input type="text" th:field="*{license}" maxlength="250"/>

            <label>전공과</label>    <input type="text" th:field="*{major}" maxlength="50" required/>
            <label>근무경력</label>  <input type="text" th:field="*{workDependsOnExperience}" maxlength="250"/>
            <label>수상경력</label>  <input type="text" th:field="*{awards}" maxlength="250"/>
            <label>학회활동</label>  <input type="text" th:field="*{societyActivity}" maxlength="250"/>
            <label>학회인증</label>  <input type="text" th:field="*{certificateOfSociety}" maxlength="250"/>

            <label>병역</label>      <input type="text" th:field="*{militaryService}" maxlength="10"/>

            <label>국적</label>
            <div>
              <span id="nationalityDisplay" th:text="*{nationality} ?: '-'">-</span>
              <button type="button" class="page-btn" style="margin-left:8px;" onclick="openCountryPopup()">국적 검색</button>
            </div>
            <input type="hidden" th:field="*{nationality}" id="nationalityInput"/>

            <label>장애 여부</label>
            <div style="display:flex;gap:12px;align-items:center;">
              <label><input type="radio" th:field="*{disabilityStatus}" value="Y" required> Y</label>
              <label><input type="radio" th:field="*{disabilityStatus}" value="N"> N</label>
            </div>

            <label>비고</label> <input type="text" th:field="*{note}" maxlength="255"/>
          </div>
        </fieldset>
      </div><!-- /detail-card -->


    </form>
    <!-- ✅ 카드 아래, 우측 정렬 버튼 (폼 안) -->
    <div class="detail-actions-outer">
      <a class="m-btn" th:href="@{/doctor/dtl/detail(id=${doctorId})}">상세 정보</a>
      <button class="m-btn" type="submit">수정</button>
    </div>
  </div>
</th:block>
</html>
