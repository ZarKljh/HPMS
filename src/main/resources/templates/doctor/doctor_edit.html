<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>ì˜ì‚¬ ìˆ˜ì • (ë©”ì¸+ë””í…Œì¼)</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; }
    fieldset { border:1px solid #ddd; border-radius:12px; padding:16px; margin-bottom:16px; }
    legend { padding:0 8px; color:#333; font-weight:600; }
    .grid { display:grid; grid-template-columns: 160px 1fr; gap:8px 12px; }
    .btn { padding:8px 12px; border:1px solid #aaa; border-radius:6px; text-decoration:none; color:#333; }
    .row { display:flex; gap:8px; align-items:center; margin-top:12px; }
    .err { color:#c00; font-size:12px; grid-column: 1 / span 2; }
    input, select { padding:6px; }
  </style>
</head>
<body>

<div class="row">
  <a class="btn" th:href="@{/doctor/detail(id=${doctorId})}">â† ìƒì„¸</a>
  <h2>ì˜ì‚¬ ìˆ˜ì • (ë©”ì¸ + ë””í…Œì¼)</h2>
</div>

<!-- ë©”ì¸ ì €ì¥ í¼ (ë‹¨ì¼ í¼ë§Œ ì¡´ì¬) -->
<form th:action="@{/doctor/edit/{id}(id=${doctorId})}" method="post" th:object="${mForm}">
  <!-- ë©”ì¸ ì •ë³´ -->
  <fieldset>
    <legend>ë©”ì¸ ì •ë³´</legend>
    <div class="grid">
      <label>ë¶€ì„œ</label> <input type="text" th:field="*{department}" maxlength="4" required/>
      <label>ì§„ë£Œê³¼</label> <input type="text" th:field="*{medicalDepartment}" maxlength="50"/>

      <label>ì§ê¸‰</label> <input type="text" th:field="*{rank}" maxlength="4" required/>
      <label>ì§ì±…</label> <input type="text" th:field="*{position}" maxlength="4"/>

      <label>ì´ë¦„</label> <input type="text" th:field="*{firstName}" maxlength="50" required/>
      <label>ì„±</label>   <input type="text" th:field="*{lastName}" maxlength="50" required/>
      <label>ì¤‘ê°„ì´ë¦„</label> <input type="text" th:field="*{middleName}" maxlength="50"/>

      <label>ì„±ë³„</label>
      <div style="display:flex; gap:12px; align-items:center;">
        <label><input type="radio" th:field="*{gender}" value="M" required> M</label>
        <label><input type="radio" th:field="*{gender}" value="F"> F</label>
      </div>

      <label>ìƒë…„ì›”ì¼</label> <input type="date" th:field="*{dateOfBirth}" required/>
      <label>ì „í™”ë²ˆí˜¸</label> <input type="text" th:field="*{telephone}" maxlength="20" required/>

      <label>ì…ì‚¬ì¼</label> <input type="date" th:field="*{hireDate}" required/>

      <label>ìƒíƒœ</label> <input type="text" th:field="*{status}" maxlength="3" required/>
      <label>ê·¼ë¬´í˜•íƒœ</label> <input type="text" th:field="*{workType}" maxlength="4" required/>

      <div class="err" th:if="${#fields.hasAnyErrors()}">
        <div th:each="e: ${#fields.errors('*')}" th:text="${e}">ì—ëŸ¬</div>
      </div>
    </div>
  </fieldset>

  <!-- ë””í…Œì¼ ì •ë³´ -->
  <fieldset th:object="${dForm}">
    <legend>ë””í…Œì¼ ì •ë³´</legend>
    <input type="hidden" th:field="*{doctorId}"/>

    <div class="grid">
      <label>ì´ë¯¸ì§€ URL</label> <input type="text" th:field="*{image}" maxlength="250" required/>
      <label>User ID</label>   <input type="text" th:field="*{userId}" maxlength="20" required/>
      <label>Password (ë³€ê²½ ì‹œì—ë§Œ ì…ë ¥)</label>
      <input type="password" th:field="*{userPassword}" maxlength="100" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
      <label>ì‚¬ë¬´ì‹¤ ì „í™”</label> <input type="text" th:field="*{officeTelephone}" maxlength="20" required/>
      <label>ë¹„ìƒì—°ë½ì²˜</label>  <input type="text" th:field="*{emergencyContact}" maxlength="20"/>

      <label>ë¹„ìƒ-ì´ë¦„</label> <input type="text" th:field="*{emergencyFirstName}" maxlength="50"/>
      <label>ë¹„ìƒ-ì„±</label>   <input type="text" th:field="*{emergencyLastName}" maxlength="50"/>
      <label>ë¹„ìƒ-ì¤‘ê°„ì´ë¦„</label> <input type="text" th:field="*{emergencyMiddleName}" maxlength="50"/>
      <label>ë¹„ìƒ-ê´€ê³„</label> <input type="text" th:field="*{emergencyRelation}" maxlength="10"/>
      <label>ë¹„ìƒ-ë¹„ê³ </label> <input type="text" th:field="*{emergencyNote}" maxlength="250"/>

      <label>ì´ë©”ì¼</label>    <input type="email" th:field="*{email}" maxlength="250"/>
      <!-- doctor_edit.html (ë˜ëŠ” new.html) ë””í…Œì¼ ì£¼ì†Œ ì˜ì—­ì— ì¶”ê°€/ìˆ˜ì •) -->
      <label>ìš°í¸ë²ˆí˜¸</label><input type="text" th:field="*{postcode}" id="postcode" maxlength="10"/>
      <label>ì£¼ì†Œ</label>
      <div style="display:flex; gap:8px; align-items:center;">
        <input type="text" th:field="*{defaultAddress}" id="addr1" maxlength="250"/>
        <button type="button" class="btn" onclick="openRoadPopup()">ë„ë¡œëª… ê²€ìƒ‰</button>
      </div>
      <label>ìƒì„¸ì£¼ì†Œ</label>
      <input type="text" th:field="*{detailedAddress}" id="addr2" maxlength="250"/>
      <label>ë©´í—ˆë²ˆí˜¸</label>  <input type="text" th:field="*{registrationNumber}" maxlength="10" required/>
      <label>í•™ë ¥</label>      <input type="text" th:field="*{educationalBackground}" maxlength="100"/>
      <label>ì™¸êµ­ì–´</label>    <input type="text" th:field="*{foreignLanguage}" maxlength="250"/>
      <label>ê¸°íƒ€ìê²©ì¦</label> <input type="text" th:field="*{license}" maxlength="250"/>

      <label>ì „ê³µê³¼</label>    <input type="text" th:field="*{major}" maxlength="50" required/>
      <label>ê·¼ë¬´ê²½ë ¥</label>  <input type="text" th:field="*{workDependsOnExperience}" maxlength="250"/>
      <label>ìˆ˜ìƒê²½ë ¥</label>  <input type="text" th:field="*{awards}" maxlength="250"/>
      <label>í•™íšŒí™œë™</label>  <input type="text" th:field="*{societyActivity}" maxlength="250"/>
      <label>í•™íšŒì¸ì¦</label>  <input type="text" th:field="*{certificateOfSociety}" maxlength="250"/>

      <label>ë³‘ì—­</label>      <input type="text" th:field="*{militaryService}" maxlength="10"/>
      <input type="hidden" th:field="*{nationality}" />
      <label>êµ­ì </label>
      <div>
        <span id="nationalityDisplay" th:text="*{nationality} ?: '-'">-</span>
        <button type="button" class="btn" style="margin-left:8px;" onclick="openCountryPopup()">êµ­ì  ê²€ìƒ‰</button>
      </div>

      <label>ì¥ì•  ì—¬ë¶€</label>
      <div style="display:flex; gap:12px; align-items:center;">
        <label><input type="radio" th:field="*{disabilityStatus}" value="Y" required> Y</label>
        <label><input type="radio" th:field="*{disabilityStatus}" value="N"> N</label>
      </div>
      <div class="err" th:if="${#fields.hasErrors('disabilityStatus')}" th:errors="*{disabilityStatus}"></div>

      <label>ë¹„ê³ </label>
      <input type="text" th:field="*{note}" maxlength="255"/>

      <div class="err" th:if="${#fields.hasAnyErrors()}">
        <div th:each="e: ${#fields.errors('*')}" th:text="${e}">ì—ëŸ¬</div>
      </div>
    </div>
  </fieldset>

  <div class="row" style="justify-content:flex-end;">
    <button class="btn" type="submit">ìˆ˜ì • ì €ì¥</button>
  </div>
</form>

<!-- âœ… êµ­ì  ìë™ì €ì¥ìš© í¼ì„ ë©”ì¸ í¼ 'ë°”ê¹¥'ì— ë‘”ë‹¤ -->
<!-- ìˆ¨ê¹€ í¼ -->
<form id="nationalityForm"
      th:action="@{/doctor/{id}/nationality(id=${doctorId})}"
      method="post"
      target="hiddenFrame"
style="display:none;">
<input type="hidden" name="iso2" id="nationalityCodeInput"/>
<input type="hidden" name="countryKr" id="nationalityNameInput"/>
  <!-- CSRF ì‚¬ìš© ì‹œ ì¶”ê°€
   <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
   -->
</form>

<!-- ğŸ‘‡ ì´ iframeì„ ë°”ë¡œ ë°‘ì— ë‘ë©´ ì•ˆì „ -->
<iframe name="hiddenFrame" style="display:none;"></iframe>


<script>
  function openCountryPopup() {
    const w = 780, h = 620;
    const left = (screen.width - w) / 2;
    const top = (screen.height - h) / 2;
    // íŒì—… URLì€ ì‚¬ìš© ì¤‘ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ ê²½ë¡œì— ë§ì¶° í†µì¼
    window.open('/global/road/popup', 'countryPopup',
      `width=${w},height=${h},left=${left},top=${top},resizable=yes,scrollbars=yes`);
  }


  function setCountry(iso2, countryKr) {
  const disp = document.getElementById('nationalityDisplay');
  if (disp) disp.textContent = `${countryKr} (${iso2})`;

  // ìˆ¨ê¹€ ì…ë ¥ì—ë„ ê°’ì„ ì±„ì›Œì„œ ë©”ì¸ í¼ submit ì‹œ ìœ ì§€ë˜ë„ë¡
  const hiddenNationality = document.querySelector('input[name="nationality"]');
  if (hiddenNationality) hiddenNationality.value = `${countryKr} (${iso2})`;

  // (ë³„ë„ ì €ì¥ì„ ê³„ì† ì“°ì‹ ë‹¤ë©´) iframe íƒ€ê²Ÿ í¼ ì œì¶œì€ ê·¸ëŒ€ë¡œ
  document.getElementById('nationalityCodeInput').value = iso2;
  document.getElementById('nationalityNameInput').value = countryKr;
  document.getElementById('nationalityForm').submit();
}

  function openRoadPopup() {
    const w = 900, h = 640;
    const left = (screen.width - w)/2, top = (screen.height - h)/2;
    window.open('/global/road_name_form', 'roadPopup',
      `width=${w},height=${h},left=${left},top=${top},resizable=yes,scrollbars=yes`);
  }

  // íŒì—…ì—ì„œ í˜¸ì¶œ: ê°’ë§Œ ì±„ì›€ (ì €ì¥ì€ ìµœì¢… "ìˆ˜ì • ì €ì¥"ì—ì„œ í•¨ê»˜)
  function setRoad(addrStr, roadCode, emdSeqNo) {
    // ê¸°ë³¸ì£¼ì†Œì— ë„ë¡œëª… ê¸°ë°˜ ì£¼ì†Œë¥¼ ì±„ìš°ê³ , ìƒì„¸ì£¼ì†ŒëŠ” ì‚¬ìš©ìê°€ ì´ì–´ì„œ ì…ë ¥
    document.getElementById('addr1').value = addrStr || '';
    // í•„ìš”í•˜ë©´ ìˆ¨ê¹€ í•„ë“œë¡œ roadCode/emdSeqNo ë”°ë¡œ ë³´ê´€ ê°€ëŠ¥
    // ì˜ˆ: <input type="hidden" name="roadCode" id="roadCodeHidden"> ë“±ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë‘ê³  ê°’ë§Œ ì£¼ì…
    // document.getElementById('roadCodeHidden').value = roadCode || '';
    // document.getElementById('emdSeqHidden').value  = emdSeqNo || '';
  }
</script>

</body>
</html>
