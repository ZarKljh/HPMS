<!doctype html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{doctor/doctor_layout}">

<!--
  ✅ 이 페이지에서는 /js/hpms-validators.js 에 있는 공통 유효성 검사 함수를 사용합니다.
  - validatePhoneNumberDigits, validateEmergencyDigits, validateFaxDigits, validateMobileDigits, validatePostcodeDigits
  - validateDetailedAddressNotEmpty, attachDigitOnlyInput
  각 기능은 아래 하단 <script>에서 바인딩되어 submit 시 검증됩니다.
-->

<th:block layout:fragment="content">
    <!-- ✅ 버튼류 호버 시 밑줄 제거 -->

    <div class="container my-3">
        <!-- 에러 메시지 -->
        <div th:if="${errorMessage != null}" class="alert alert-danger">
            <p th:text="${errorMessage}"></p>
        </div>

        <!-- ✅ doctorId는 컨트롤러에서 모델로 전달받아 사용 -->
        <form th:action="@{/doctor/edit/{id}(id=${doctorId})}" method="post" th:object="${mForm}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <h3 class="border-bottom mt-2">의사 정보 수정</h3>

            <!-- DoctorMain -->
            <div class="doctormain card my-3 p-3">
                <h4 class="border-bottom mt-2">기본 정보</h4>

                <div class="input-list">
                    <label>부서:</label>
                    <input type="text" th:field="*{department}" maxlength="4" required/>
                </div>

                <div class="input-list">
                    <label>진료과:</label>
                    <input type="text" th:field="*{medicalDepartment}" maxlength="50"/>
                </div>

                <div class="input-list">
                    <label>직급:</label>
                    <input type="text" id="rank" th:field="*{rank}" maxlength="4"/>
                </div>

                <div class="input-list">
                    <label>직책:</label>
                    <input type="text" id="position" th:field="*{position}" maxlength="4"/>
                </div>

                <!-- 팝업: a태그 사용 -->
                <div class="input-list" style="gap:8px; align-items:center;">
                    <a href="javascript:void(0)" class="button-link" onclick="openJobPopup()">직급/직책 선택</a>
                </div>

                <div class="input-list">
                    <label>이름:</label>
                    <input type="text" th:field="*{firstName}" maxlength="50" required/>
                </div>

                <div class="input-list">
                    <label>성:</label>
                    <input type="text" th:field="*{lastName}" maxlength="50" required/>
                </div>

                <div class="input-list">
                    <label>중간 이름:</label>
                    <input type="text" th:field="*{middleName}" maxlength="50"/>
                </div>

                <div class="input-list">
                    <label>성별:</label>
                    <div class="form-check" style="display:flex; gap:16px; align-items:center;">
                        <label class="mb-0"><input type="radio" th:field="*{gender}" value="M" required/> 남</label>
                        <label class="mb-0"><input type="radio" th:field="*{gender}" value="F"/> 여</label>
                    </div>
                </div>

                <div class="input-list">
                    <label>생년월일:</label>
                    <input type="date" th:field="*{dateOfBirth}" required/>
                </div>

                <div class="input-list">
                    <label>전화번호:</label>
                    <!-- ✅ 숫자만 허용(공통 스크립트로 제어) / id는 th:field로 'telephone' 생성 -->
                    <input type="text" th:field="*{telephone}" maxlength="20" required/>
                </div>

                <div class="input-list">
                    <label>입사일:</label>
                    <input type="date" th:field="*{hireDate}" required/>
                </div>

                <div class="input-list">
                    <label>상태:</label>
                    <input type="text" th:field="*{status}" maxlength="3" required/>
                </div>

                <div class="input-list">
                    <label>근무형태:</label>
                    <input type="text" th:field="*{workType}" maxlength="4" required/>
                </div>
            </div>

            <!-- DoctorDetail : dForm 바인딩 -->
            <div class="doctordetail card my-3 p-3" th:object="${dForm}">
                <h3 class="border-bottom mt-2">상세 정보</h3>
                <input type="hidden" th:field="*{doctorId}"/>

                <div class="input-list">
                    <label>이미지 URL:</label>
                    <input type="text" th:field="*{image}" maxlength="250" required/>
                </div>

                <div class="input-list">
                    <label>User ID:</label>
                    <input type="text" th:field="*{userId}" maxlength="20" required/>
                </div>

                <div class="input-list">
                    <label>Password:</label>
                    <input type="password" th:field="*{userPassword}" maxlength="100" placeholder="새 비밀번호 입력"/>
                </div>

                <div class="input-list">
                    <label>사무실 전화:</label>
                    <!-- ✅ 숫자만 허용 -->
                    <input type="text" th:field="*{officeTelephone}" maxlength="20" required/>
                </div>

                <div class="input-list">
                    <label>비상연락처:</label>
                    <!-- ✅ 숫자만 허용 -->
                    <input type="text" th:field="*{emergencyContact}" maxlength="20"/>
                </div>

                <!-- 필요 시 팩스/휴대폰 필드 자동 적용(id: faxNumber, mobilePhone) -->

                <div class="input-list">
                    <label>비상-이름:</label>
                    <input type="text" th:field="*{emergencyFirstName}" maxlength="50"/>
                </div>

                <div class="input-list">
                    <label>비상-성:</label>
                    <input type="text" th:field="*{emergencyLastName}" maxlength="50"/>
                </div>

                <div class="input-list">
                    <label>비상-중간이름:</label>
                    <input type="text" th:field="*{emergencyMiddleName}" maxlength="50"/>
                </div>

                <div class="input-list">
                    <label>비상-관계:</label>
                    <input type="text" th:field="*{emergencyRelation}" maxlength="10"/>
                </div>

                <div class="input-list">
                    <label>비상-비고:</label>
                    <input type="text" th:field="*{emergencyNote}" maxlength="250"/>
                </div>

                <div class="input-list">
                    <label>이메일:</label>
                    <input type="email" th:field="*{email}" maxlength="250"/>
                </div>

                <div class="input-list">
                    <label>우편번호:</label>
                    <!-- ✅ 숫자만 허용 -->
                    <input type="text" th:field="*{postcode}" maxlength="6"/>
                </div>

                <div class="input-list">
                    <label>도로명주소:</label>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input type="text" th:field="*{defaultAddress}" id="addr1" maxlength="250"/>
                        <a href="javascript:void(0)" class="button-link" onclick="openRoadPopup()">도로명 검색</a>
                    </div>
                </div>

                <div class="input-list">
                    <label>상세주소:</label>
                    <!-- ✅ Null/빈값 등록불가 (submit에서 체크) -->
                    <input type="text" th:field="*{detailedAddress}" maxlength="250"/>
                </div>

                <div class="input-list">
                    <label>면허번호:</label>
                    <input type="text" th:field="*{registrationNumber}" maxlength="10" required/>
                </div>

                <div class="input-list">
                    <label>학력:</label>
                    <input type="text" th:field="*{educationalBackground}" maxlength="100"/>
                </div>

                <div class="input-list">
                    <label>외국어:</label>
                    <input type="text" th:field="*{foreignLanguage}" maxlength="250"/>
                </div>

                <div class="input-list">
                    <label>기타 자격증:</label>
                    <input type="text" th:field="*{license}" maxlength="250"/>
                </div>

                <div class="input-list">
                    <label>전공과:</label>
                    <input type="text" th:field="*{major}" maxlength="50" required/>
                </div>

                <div class="input-list">
                    <label>근무경력:</label>
                    <input type="text" th:field="*{workDependsOnExperience}" maxlength="250"/>
                </div>

                <div class="input-list">
                    <label>수상경력:</label>
                    <input type="text" th:field="*{awards}" maxlength="250"/>
                </div>

                <div class="input-list">
                    <label>학회활동:</label>
                    <input type="text" th:field="*{societyActivity}" maxlength="250"/>
                </div>

                <div class="input-list">
                    <label>학회인증:</label>
                    <input type="text" th:field="*{certificateOfSociety}" maxlength="250"/>
                </div>

                <div class="input-list">
                    <label>병역:</label>
                    <input type="text" th:field="*{militaryService}" maxlength="10"/>
                </div>

                <div class="input-list">
                    <label>국적:</label>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <span id="nationalityDisplay" th:text="*{nationality} ?: '-'">-</span>
                        <input type="hidden" th:field="*{nationality}" id="nationalityInput"/>
                        <a href="javascript:void(0)" class="button-link" onclick="openCountryPopup()">국적 검색</a>
                    </div>
                </div>

                <div class="input-list">
                    <label>장애 여부:</label>
                    <div class="form-check" style="display:flex; gap:16px; align-items:center;">
                        <label class="mb-0"><input type="radio" th:field="*{disabilityStatus}" value="Y" required/> 유</label>
                        <label class="mb-0"><input type="radio" th:field="*{disabilityStatus}" value="N"/> 무</label>
                    </div>
                </div>

                <div class="input-list">
                    <label>비고:</label>
                    <input type="text" th:field="*{note}" maxlength="255"/>
                </div>
            </div>

            <!-- 하단 버튼 -->
            <div class="c_c_btn_box d-flex justify-content-end">
                <button type="submit" class="button-link me-2">저장</button>
                <!-- ✅ 상세 페이지로 복귀 -->
                <a th:href="@{/doctor/dtl/detail(id=${doctorId})}" class="button-link">취소</a>
            </div>
        </form>

        <div th:if="${errorMessage}" th:text="${errorMessage}" style="color:red;"></div>
    </div>
</th:block>

<!-- ✅ 공통 유효성 검사 스크립트 로드 -->

</html>
