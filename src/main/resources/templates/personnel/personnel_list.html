<html lang="kr" layout:decorate="~{personnel/personnel_layout}">
<div layout:fragment="content" class="container">
    <h2 class="listbox">Reference Personnel List</h2>
    <form method="get" action="/user/list">
        <div class="mb-3">
            <strong>등록 건수:</strong> <span th:text="${totalNum}"></span>명 /
            <strong>현재 페이지:</strong> <span th:text="${currentPage}"></span> /
            <strong>페이지당 행 수:</strong> <!--<span th:text="${size}"></span>-->
            <!--<label for="size">Row counter:</label>-->
            <select name="size" id="size" onchange="this.form.submit();">
                <option th:value="5" th:selected="${size == 5}">5</option>
                <option th:value="10" th:selected="${size == 10}">10</option>
                <option th:value="20" th:selected="${size == 20}">20</option>
                <input type="hidden" name="page" value="1" />
            </select>
        </div>
    </form>
    <div id="personnel-list"> <!-- 여기에 서버에서 받아온 리스트 HTML이 들어갑니다 -->
        <form name="selectedPersonnel" th:action="@{/delete/selectedPersonnel}" method="post">
            <input type="hidden" name="page" th:value="${page}" />
            <input type="hidden" name="size" th:value="${size}" />
        <table class="table table-hover card" style="border:1px;">
            <thead class="table-info" style="padding:0px;margin:0px;border:1px;">
                <tr class=" text-center" style="border:1px;">
                    <th style="width:20px"><input type="checkbox" name="checkedAllIds" value="t" /></th>
                    <th style="border:1px solid red;">ID</th>
                    <th>국적</th>
                    <th>성명</th>
                    <th>중간이름</th>
                    <th>이메일</th>
                    <th>휴대전화</th>
                    <th>등록자</th>
                    <th>등록일시</th>
                </tr>
            </thead>
            <tbody class="text-center">
            <tr th:each="personnel : ${referencePersonnels}">
                <td>
                    <!--
                        <input type="checkbox" th:field="${personnel.id}"/>
                        th:field는 폼 필드와 모델 객체의 바인딩을 위해 사용되는 속성입니다.
                        즉, <input>이 form backing bean의 필드와 연결되어야 할 때 사용하는 거예요.
                        그런데 지금은 단순히 체크박스를 통해 여러 항목을 선택하고 삭제하는 기능을 구현하려는 것이므로,
                        th:field는 적절하지 않습니다.
                    -->
                    <input type="checkbox" th:name="checkedIds" th:value="${personnel.id}" />
                </td>
                <td>
                    <a th:if="${personnel.id != null}"
                       th:href="|/user/detail/${personnel.id}?size=${size != null ? size : 0}&page=${page != null ? page : 0}|"
                       th:text="${personnel.id}">
                    </a>
                </td>
                <td th:text="${personnel.nationality}"></td>
                <td>
                    <a th:if="${personnel.id != null}"
                       th:href="|/user/detail/${personnel.id}?size=${size != null ? size : 10}&page=${currentPage != null ? currentPage : 1}|"
                       th:text="${personnel.middleName != null && personnel.middleName != ''
                 ? personnel.lastName + ' ' + personnel.middleName + ' ' + personnel.firstName
                 : personnel.lastName + ' ' + personnel.firstName}"></a>
                </td>
                <td th:text="${personnel.middleName}"></td>
                <td th:text="${personnel.email}"></td>
                <td th:text="${personnel.cellPhone}"></td>
                <td th:text="${personnel.creator ?: '미지정'}"></td>
                <td th:text="${#temporals.format(personnel.createDate, 'yyyy-MM-dd HH:mm')}"></td>
            </tr>
            </tbody>
        </table>
        </form>
        </div><!-- end of personnel-list-->
    <div class="page-navigation">
        <div>
    <!--        <form id="registrationForm" method="post" action="/user/personnel_registration">
                <input name="size" type="hidden" th:value="${size}" >
                &lt;!&ndash;<input name="page" type="text" th:value="${page}" hidden="hidden">&ndash;&gt;
                <input type="hidden" name="page" th:value="${currentPage}" />
                <a href="#" class="button-link text-full" onclick="event.preventDefault();submitForm(event);">
                    등록하기
                </a>
                <a href="#" class="button-link text-short" onclick="event.preventDefault();submitForm(event);">
                    등록
                </a>-->
            <a th:href="@{/user/personnel_registration}+'?page='+${currentPage}+'&size='+${size}" class="button-link text-full">
                등록하기
            </a>
            <a href="@{/user/personnel_registration}+'?page='+${currentPage}+'&size='+${size}" class="button-link text-short">
                등록
            </a>
            <a href="#" class="button-link text-full" onclick="submitFormIfValid();">삭제하기</a>
            <a href="#" class="button-link text-short" onclick="submitFormIfValid();">삭제</a>
    <!--        </form>-->
        </div>
        <div class="pagination">
            <a th:if="${currentPage > 1}"
               th:href="@{/user/list(page=1, size=${size})}">처음</a>

            <a th:if="${currentPage > 1}"
               th:href="@{/user/list(page=${currentPage - 1}, size=${size})}">이전</a>

            <span th:each="pageNum : ${pageNumbers}">
                <a th:href="@{/user/list(page=${pageNum}, size=${size})}"
                    th:text="${pageNum}"
                    th:class="${pageNum == currentPage} ? 'active-page' : ''"></a>
            </span>

            <a th:if="${currentPage < totalPages}"
               th:href="@{/user/list(page=${currentPage + 1}, size=${size})}">다음</a>

            <a th:if="${currentPage < totalPages}"
               th:href="@{/user/list(page=${totalPages}, size=${size})}">끝</a>
        </div>
    </div>
</div>
</html>