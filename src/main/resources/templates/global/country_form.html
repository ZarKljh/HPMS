<!-- src/main/resources/templates/global/country_form.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>국적 검색</title>
    <style>
        body { font-family: system-ui, sans-serif; padding: 14px; }
        .searchbar { display:flex; gap:8px; margin-bottom:12px; }
        table { width:100%; border-collapse: collapse; }
        th, td { border:1px solid #ddd; padding:8px; }
        tr:hover { background:#f7f7f7; cursor:pointer; }
        .pagination { margin-top: 12px; display:flex; gap:8px; align-items:center; }
    </style>
</head>
<body>

<h3>국적 검색</h3>

<form class="searchbar" method="get" th:action="@{/global/country_form}">
    <input type="text" name="kw" placeholder="국가명/ISO/숫자" th:value="${kw}" />
    <button type="submit">검색</button>
    <a th:href="@{/global/country_form}" style="margin-left:auto">전체보기</a>
</form>

<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>ISO2</th>
        <th>ISO3</th>
        <th>NUM</th>
        <th>국가명(한)</th>
        <th>국가명(EN)</th>
        <th>대륙(공통)</th>
        <th>선택</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="c : ${page.content}"
        th:attr="data-iso2=${c.isoAlpha2}, data-country=${c.countryKr}"
        ondblclick="choose(this.dataset.iso2, this.dataset.country)">
        <td th:text="${c.id}">1</td>
        <td th:text="${c.isoAlpha2}">KR</td>
        <td th:text="${c.isoAlpha3}">KOR</td>
        <td th:text="${c.numeric}">410</td>
        <td th:text="${c.countryKr}">대한민국</td>
        <td th:text="${c.countryEn}">Korea, Republic of</td>
        <td th:text="${c.continentCommon}">Asia</td>
        <td>
            <button type="button"
                    th:attr="data-iso2=${c.isoAlpha2}, data-country=${c.countryKr}"
                    onclick="choose(this.dataset.iso2, this.dataset.country)">
                선택
            </button>
        </td>
    </tr>
    <tr th:if="${page.content.isEmpty()}">
        <td colspan="8" style="text-align:center">검색 결과가 없습니다.</td>
    </tr>
    </tbody>
</table>

<div class="pagination" th:if="${page.totalPages > 1}">
    <a th:if="${!page.first}"
       th:href="@{/global/country_form(page=${page.number - 1}, size=${page.size}, kw=${kw})}">&lt; 이전</a>
    <span th:text="|${page.number + 1} / ${page.totalPages}|">1/1</span>
    <a th:if="${!page.last}"
       th:href="@{/global/country_form(page=${page.number + 1}, size=${page.size}, kw=${kw})}">다음 &gt;</a>
</div>

<script>
    function choose(iso2, countryKr) {
      if (window.opener && !window.opener.closed && typeof window.opener.setCountry === 'function') {
        window.opener.setCountry(iso2, countryKr);
      }
      window.close();
    }
</script>
</body>
</html>