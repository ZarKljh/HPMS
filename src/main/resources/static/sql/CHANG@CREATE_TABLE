/*
 * 작성자 : 이창훈
 * 최초작성일자 : 20250822
 * 보완일자 : 20250825
 * 내용 : 비상주 인력 관리 테이블
 * 추가 고려사항 : 이력 관리용이므로, 이벤트 유형(예: 수정, 삭제)을 나타내는 EVENT_TYPE 컬럼을 추가
                 정상적인 이력관리가 되기 위한 누락사항들이 존재하는 것으로 추측됨
 * EVENT_TYPE ENUM('INSERT', 'UPDATE', 'DELETE') NOT NULL COMMENT '이벤트 유형'
	1. 이력관리 고려사항 배제
	2. TBL_, POSITION, CREATOR 오타 발생 전체 삭제 후 재등록필요
	    TML         ->  TBL
	    CEIL_PHONE  ->  CELL_PHONE
	    CREATER     ->  CREATOR
	    PISITION    ->  POSITION

	3. 1:1 FOREIGN 관계를 위한 UNIQUE 설정 누락에 따른 생성구문 수정
	4. FIRST_NAME, LAST_NAME,  MIDDLE_NAME으로 명칭 구분 적용

 * */

use HPMS;
CREATE TABLE TBL_REL_PERSONNEL_M (
    ID INT NOT NULL AUTO_INCREMENT COMMENT '테이블 고유값, 자동 증가',
    NATIONALITY VARCHAR(4) COMMENT '국적 N 자리 코드값',
    FIRST_NAME VARCHAR(250) COMMENT '이름',
    LAST_NAME VARCHAR(250) COMMENT '성',
    MIDDLE_NAME VARCHAR(250) COMMENT '중간이름',
    EMAIL VARCHAR(250) COMMENT '이메일주소 연락용',
    CELL_PHONE VARCHAR(30) COMMENT '휴대전화번호 연락용, 010부터입력, \'-\'미포함',
    CREATOR VARCHAR(250) COMMENT '등록된 인원(회원ID 또는 휴대전화번호)',
    CREATE_DATE TIMESTAMP NOT NULL COMMENT '생성일자 (외부에서 전달받은 값)',
    PRIMARY KEY (ID)
)COMMENT = '관련인력 기본정보';

CREATE TABLE TBL_REL_PERSONNEL_DTL (
    ID INT NOT NULL AUTO_INCREMENT COMMENT '테이블 고유값, 자동 증가',
    TBL_ETC_MEM_ID INT NOT NULL COMMENT '관련인력 테이블 고유ID',
    COMPANY_NAME VARCHAR(250) NOT NULL COMMENT '직장명 직접입력',
    DEPT_NAME VARCHAR(250) NOT NULL COMMENT '소속부서 직접입력',
    POSITION VARCHAR(250) NOT NULL COMMENT '직급/직책 직접입력',
    OFFICE_ADDRESS VARCHAR(250) COMMENT '근무지 주소 기본',
    OFFICE_DETAIL_ADDRESS VARCHAR(250) COMMENT '근무지 주소 상세',
    OFFICE_TEL VARCHAR(30) COMMENT '전화번호, 지역번호포함, \'-\'미포함',
    OFFICE_FAX VARCHAR(30) COMMENT '팩스번호, 지역번호포함, \'-\'미포함',
    COMPANY_WEBSITE_URL VARCHAR(250) COMMENT '홈페이지 주소',
    NOTE VARCHAR(300) COMMENT '비고',
    CREATOR VARCHAR(250) NOT NULL COMMENT '등록된 인원(관리자, 의사, 간호사)의 경우 회원ID, 방문자의 경우 휴대전화번호',
    CREATE_DATE TIMESTAMP NOT NULL COMMENT '생성일자 (외부에서 전달받은 값)',
    PRIMARY KEY (ID),
    UNIQUE (TBL_ETC_MEM_ID),
    FOREIGN KEY (TBL_ETC_MEM_ID) REFERENCES TBL_REL_PERSONNEL_M(ID)
) COMMENT = '관련인력 부가 상세정보';

show TABLES;

CREATE TABLE TBL_REL_PERSONNEL_H (
    ID INT NOT NULL AUTO_INCREMENT COMMENT '테이블 고유값, 자동 증가',

    /*참조 키*/
    TBL_REL_PERSONNEL_ID INT NOT NULL COMMENT '관련인력 테이블 고유ID',

    /*기본 인적 정보*/
    NATIONALITY VARCHAR(10) NOT NULL COMMENT '국적 N 자리 코드값',
    FIRST_NAME VARCHAR(250) NOT NULL COMMENT '이름',
    LAST_NAME VARCHAR(250) NOT NULL COMMENT '성',
    MIDDLE_NAME VARCHAR(250) COMMENT '중간이름',
    EMAIL VARCHAR(250) NOT NULL COMMENT '이메일주소 연락용',
    CELL_PHONE VARCHAR(30) NOT NULL COMMENT '휴대전화번호 연락용, 010부터입력, \'-\'미포함',

    /*원본 테이블(M, DTL) 생성 정보*/
    M_CREATOR VARCHAR(250) NOT NULL COMMENT 'TBL_REL_PERSONNEL_M 저장값',
    M_CREATE_DATE TIMESTAMP COMMENT 'TBL_REL_PERSONNEL_M 저장값, MYSQL NOT NULL 지정시 오류발생',
    DTL_CREATOR VARCHAR(250) NOT NULL COMMENT 'TBL_REL_PERSONNEL_DTL 저장값',
    DTL_CREATE_DATE TIMESTAMP COMMENT 'TBL_REL_PERSONNEL_DTL 저장값, MYSQL NOT NULL 지정시 오류발생',

    /*직장 관련 정보*/
    COMPANY VARCHAR(250) NOT NULL COMMENT '직장명 직접입력',
    DEPARTMENT VARCHAR(250) NOT NULL COMMENT '소속부서 직접입력',
    POSITION VARCHAR(250) NOT NULL COMMENT '직급/직책 직접입력',
    OFFICE_ADDRESS VARCHAR(250) COMMENT '근무지 주소 기본',
    OFFICE_ADDRESS_DETAIL VARCHAR(250) COMMENT '근무지 주소 상세',
    TEL VARCHAR(30) COMMENT '전화번호, 지역번호포함, \'-\'미포함',
    FAX VARCHAR(30) COMMENT '팩스번호, 지역번호포함, \'-\'미포함',
    COMPANY_WEBSITE_URL VARCHAR(250) COMMENT '홈페이지 주소',

    /*기타*/
    NOTE VARCHAR(300) COMMENT '비고',

    /*이력 테이블 자체 생성 정보*/
    CREATOR VARCHAR(250) NOT NULL COMMENT '등록된 인원(회원ID, 휴대전화번호, 배치처리시 SYS_ADMIN)',
    CREATE_DATE TIMESTAMP NOT NULL COMMENT '생성일자 - 배치처리일자',

    /*기본키 및 외래키*/
    PRIMARY KEY (ID),
    FOREIGN KEY (TBL_REL_PERSONNEL_ID) REFERENCES TBL_REL_PERSONNEL_M(ID)
) COMMENT = '관련인력 이력 관리 테이블. 마스터 및 상세 테이블의 생성정보 포함';

CREATE TABLE TBL_REL_PERSONNEL_H (
    ID INT NOT NULL AUTO_INCREMENT COMMENT '테이블 고유값, 자동 증가',
    TBL_REL_PERSONNEL_ID INT NOT NULL COMMENT '관련인력 테이블 고유ID',
    NATIONALITY VARCHAR(10) NOT NULL COMMENT '국적 N 자리 코드값',
    FIRST_NAME VARCHAR(250) NOT NULL COMMENT '이름',
    LAST_NAME VARCHAR(250) NOT NULL COMMENT '성',
    MIDDLE_NAME VARCHAR(250) COMMENT '중간이름',
    EMAIL VARCHAR(250) NOT NULL COMMENT '이메일주소 연락용',
    CELL_PHONE VARCHAR(30) NOT NULL COMMENT '휴대전화번호 연락용, 010부터입력, \'-\'미포함',
    M_CREATOR VARCHAR(250) NOT NULL COMMENT 'TBL_REL_PERSONNEL_M 저장값',
    M_CREATE_DATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'TBL_REL_PERSONNEL_M 저장값',
    DTL_CREATOR VARCHAR(250) NOT NULL COMMENT 'TBL_REL_PERSONNEL_DTL 저장값',
    DTL_CREATE_DATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'TBL_REL_PERSONNEL_DTL 저장값',
    COMPANY VARCHAR(250) NOT NULL COMMENT '직장명 직접입력',
    DEPARTMENT VARCHAR(250) NOT NULL COMMENT '소속부서 직접입력',
    POSITION VARCHAR(250) NOT NULL COMMENT '직급/직책 직접입력',
    OFFICE_ADDRESS VARCHAR(250) COMMENT '근무지 주소 기본',
    OFFICE_ADDRESS_DETAIL VARCHAR(250) COMMENT '근무지 주소 상세',
    TEL VARCHAR(30) COMMENT '전화번호, 지역번호포함, \'-\'미포함',
    FAX VARCHAR(30) COMMENT '팩스번호, 지역번호포함, \'-\'미포함',
    COMPANY_WEBSITE_URL VARCHAR(250) COMMENT '홈페이지 주소',
    NOTE VARCHAR(300) COMMENT '비고',
    CREATOR VARCHAR(250) NOT NULL COMMENT '등록된 인원(회원ID, 휴대전화번호, 배치처리시 SYS_ADMIN)',
    CREATE_DATE TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일자 - 배치처리일자',
    PRIMARY KEY (ID),
    FOREIGN KEY (TBL_REL_PERSONNEL_ID) REFERENCES TBL_REL_PERSONNEL_M(ID)
) COMMENT = '관련인력 이력 관리 테이블. 마스터 및 상세 테이블의 생성정보 포함';


